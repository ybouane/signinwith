<!DOCTYPE html>
<html>
<head>
	<title>OAuth Authentication</title>
	<style>
		body {
			font-family: sans-serif;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100vh;
			margin: 0;
			background-color: #f0f0f0;
		}
		.container {
			text-align: center;
			padding: 20px;
			background-color: #fff;
			border-radius: 8px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
		}
	</style>
</head>
<body>
	<div class="container">
		<p>You can close this window now.</p>
		<script>
			(function handleOauthResult(){
				const urlParams = new URLSearchParams(window.location.search);
				const code = urlParams.get('code');
				const error = urlParams.get('error');
				const state = urlParams.get('state');
				const serviceParam = urlParams.get('service') || urlParams.get('provider');
				const defaultService = window.opener && window.opener.__signinwithPendingProvider ? window.opener.__signinwithPendingProvider : null;
				const fallbackState = window.opener && window.opener.__signinwithPendingProviderState ? window.opener.__signinwithPendingProviderState : null;
				let service = serviceParam || defaultService || (state || '').replace(/^.*:/, '') || 'discord';
				if (!service) service = 'discord';

				const message = {
					type: `${service}Auth`,
					service,
				};
				if (code) message.code = code;
				if (state || fallbackState) message.state = state || fallbackState;
				if (error) message.error = error;

				const target = window.opener || window.parent;
				if (target && typeof target.postMessage === 'function') {
					target.postMessage(message, window.location.origin);
				}

				// Attempt to close the window
				setTimeout(() => {
					window.close();
				}, 0);
			})();
		</script>
	</div>
</body>
</html>
